<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coffee & Codes</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>â˜•</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Balloo+2:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <div class="header-img-container">
            <img src="https://i.imgur.com/WhFdlYv.jpg" alt="Katze links" class="header-img left">
        </div>
        <h1 id="main-title">Coffee and Codes</h1>
        <div class="header-img-container">
            <img src="https://i.imgur.com/vy9sUhr.jpg" alt="Katze rechts" class="header-img right">
        </div>
    </header>

    <div class="button-container" id="homeButtonContainer">
        <a href="/" class="nav-button active" data-page="home">ğŸ  Home</a>
        <a href="/github-connect.html" class="nav-button" data-page="github-connect">ğŸ”— GitHub Connect</a>
        <a href="#" class="nav-button" data-page="dashboard" id="codemasterTab">!Code.Master()</a>
        <a href="https://discord.gg/Xvqa7GFJGN" class="nav-button" target="_blank">
            ğŸ© To Discord Community
        </a>
    </div>

    <div id="page-container">
        <!-- HOME PAGE -->
        <div id="home-page" class="page active">
            <div class="container">
            <div class="column">
            <h1 class="col-headline">Coffey & Codes</h1>
            <div class="col-head-sep" aria-hidden="true"></div>
            <div class="col-text">
                <ul class="heart-list">
                    <li>Coffee & Codes ist ein gemÃ¼tlicher Discord-Spot fÃ¼r entspannte GesprÃ¤che, Codes-solving, neue Leute kennen zu lernen und kleine Alltagsmomente zu teilen. </li>

                    <li>Wie ein digitales CafÃ© an der Ecke: mal ruhig, mal lebendig.<br>
                    Wir sind ein Hub, indem es mehr Ã¼ber Codes, weniger (also gar nicht) um Kindergarten (Anime-UWU) geht. Memes/ tasty food wie auch Gym-momente werden hier geteilt â€“ hier zÃ¤hlt kein Hype, sondern echte Stimmung.</li>

                    <li>Noch ist alles im Aufbau (darum auch noch weniger AnhÃ¤nger [gerne teilen])â€“ also perfekt, um von Anfang an dabei zu sein. dazu gibt es fÃ¼r die ersten 25 Member eine speziel Rolle. ğŸ•Šï¸</li>
                </ul>
            </div>

            <div class="github-button-container">
                <a href="https://github.com/molaskidata" class="github-button" target="_blank">
                    ğŸ’» GitHub
                </a>
            </div>
        </div>
        
        <div class="column">
            <h1 class="col-headline"> Was dich erwartet</h1>
            <div class="col-head-sep" aria-hidden="true"></div>
            <div class="col-text">
                <ul class="heart-list">
                    <li><strong>Roles</strong><br>
                    Stell dich mithilfe Reaction-Roles vor. Wer du bist â€“ Kontinent, Sternzeichen, Interessen. Easy per Klick. ğŸ”–</li>

                    <li><strong>Cafe-Talk</strong><br>
                    Hier passiert's: AlltagsgesprÃ¤che, kleine Diskussionen oder einfach ein â€Moin". â˜•</li>

                    <li><strong>Voice & Musik</strong><br>
                    Chillcalls, Musik hÃ¶ren oder einfach reden â€“ ganz spontan. ğŸ§</li>

                    <li><strong>Medien & Memes</strong><br>
                    Teile Bilder, Kunst, Games oder einfach witzige Momente â€“ locker & SFW. ğŸ“¸</li>

                    <li><strong>Events & Giveaways</strong><br>
                    Ab und zu kleine Aktionen oder Gewinne â€“ kein Spam, einfach SpaÃŸ. ğŸ®</li>
                </ul>
            </div>
        </div>
        <div class="column">
            <h1 class="col-headline"> Mitmachen & Verifizieren</h1>
            <div class="col-head-sep" aria-hidden="true"></div>
            <div class="col-text">
                <ul class="heart-list">
                    <li><strong>Verifizieren</strong><br>Kurz im "#ğŸª|Verification" klicken â€“ und du bist drin. Keine Umwege.</li>

                    <li><strong>Rollen wÃ¤hlen</strong><br>Im "#ğŸ“Œ|Roles" einfach Emojis anklicken, fertig.ğŸŒŸ</li>

                    <li><strong>Loslegen!</strong><br>Spring in den "#â˜•|Cafe-Talk" oder chill im Voice. Alles easy.</li>

                    <li><strong>Support</strong><br>Fragen? Das Team hilft fix im "#ğŸª|Support".ğŸ€</li>
                </ul>
            </div>

            <div class="discord-profile-button-container">
                <a href="https://discord.com/users/1105877268775051316" class="discord-profile-button" target="_blank">
                    ğŸ‘¤ /help
                </a>
            </div>
        </div>
        <!-- Latest posts only in Home tab -->
        <div class="content-feed-section">
            <div class="content-feed-header">
                <h2 class="content-feed-title"> Latest posts from "Â«ğŸ©Â»â”†ğ—§ğ—²ğ—¹ğ—²ğ—½ğ—¼ğ—¿ğ˜ğ—®ğ˜ğ—¶ğ—¼ğ—»":</h2>
            </div>
            <div class="content-feed-card">
                <div class="content-feed-container" id="contentFeedContainer">
                    <div class="loading-message">
                        Loading latest content...
                    </div>
                </div>
        </div>
            </div>
        </div>
            </div>
        </div>

        <!-- DASHBOARD PAGE (moved outside Home) -->
        <div id="dashboard-page" class="page">
            <div class="container" style="align-items:flex-start; gap:24px;">
                <div style="flex:1; max-width:680px;">
                    <div class="column" id="left-dashboard">
                        <h2 class="col-headline">Server Overview</h2>
                        <div id="server-count" style="font-size:2.2rem; font-weight:700; margin-bottom:12px; color:#fff">Servers: â€”</div>
                        <div id="commands-list" style="margin-top:10px;">
                            <h3 style="margin:6px 0 8px 0; color:#dff3ff;">Commands (short)</h3>
                            <div id="cmds" style="display:flex;flex-direction:column;gap:8px;color:#eaf6ff;"></div>
                        </div>
                    </div>
                </div>

                <div style="width:320px;">
                    <div class="column" id="right-dashboard">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                            <div style="font-size:0.95rem;color:#dff3ff;font-weight:600">!Code.Master() Dashboard</div>
                            <a href="#" class="nav-button" data-page="home" id="dashboardHomeBtn" style="padding:8px 12px;font-size:0.9rem;border-radius:12px;">ğŸ  Home</a>
                        </div>
                        <h2 class="col-headline">Bot Status</h2>
                        <div style="display:flex;align-items:center;gap:12px;margin-top:12px;">
                            <div id="status-dot" style="width:18px;height:18px;border-radius:50%;background:gray;box-shadow:0 0 8px rgba(0,0,0,0.6);"></div>
                            <div id="status-text" style="font-weight:600;color:#fff;font-size:1.1rem;">â€”</div>
                        </div>
                        <div style="margin-top:18px;color:#dcefff;">
                            <div>Uptime: <span id="uptime">â€”</span></div>
                            <div>Last checked: <span id="last-checked">â€”</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- GITHUB CONNECT PAGE -->
        <div id="github-connect-page" class="page">
            <div class="github-connect-container">
                <div class="github-connect-card">
                    <div class="github-connect-icon">ğŸ”—</div>
                    <h2 class="github-connect-title">Connect your GitHub for Discord XP & Leveling!</h2>
                    <p class="github-connect-description">
                        Log in with your GitHub account to link it with your Discord profile. Your GitHub activity (commits, contributions) will be used to rank you and award XP/levels in our Discord server!<br><br>
                        Click below to securely connect your GitHub account and unlock exclusive roles and rewards.
                    </p>
                    <a href="#" class="connect-button" id="connectBtn">Connect GitHub Account</a>
                </div>
            </div>
        </div>
    </div>

    <div class="gallery-section">
        <div class="gallery-container">
        </div>
    </div>    <footer class="site-footer">
        <div class="site-footer-inner">
            <span>Â© 2025 MOLA | </span>
            <a href="terms&privacy/terms-of-service.html" target="_blank">AGB</a> |
            <a href="terms&privacy/privacy-policy.html" target="_blank">Dataprotection</a> |
            <a href="https://discord.gg/Xvqa7GFJGN" target="_blank" rel="noopener noreferrer">Coffee & Codes</a>
        </div>
    </footer>
    
    <script src="shades.js"></script>
    <script>
        // Page Navigation
        document.querySelectorAll('.tab-button, .nav-button').forEach(btn => {
            btn.addEventListener('click', function() {
                const page = this.getAttribute('data-page');
                navigateTo(page);
            });
        });

        // Dashboard data fetch & rendering
        async function fetchDashboard() {
            // Use relative path so the site domain can proxy to the bot service (via nginx)
            const url = '/api/dashboard';
            try {
                const res = await fetch(url, { cache: 'no-store' });
                if (!res.ok) throw new Error('no-data');
                const data = await res.json();
                renderDashboard(data);
            } catch (e) {
                renderDashboard({ status: 'offline', presence: 'offline', guildCount: 0, commands: [], uptime: 0, timestamp: new Date().toISOString() });
            }
        }

        function renderDashboard(data) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');
            const sc = document.getElementById('server-count');
            const cmds = document.getElementById('cmds');
            const up = document.getElementById('uptime');
            const lc = document.getElementById('last-checked');

            // Map status to colors
            let color = '#808080';
            let label = 'Offline';
            if (data.status === 'online' || data.presence === 'online') { color = '#2ecc71'; label = 'Online'; }
            else if (data.presence === 'idle' || data.presence === 'dnd') { color = '#f1c40f'; label = 'Stand By'; }
            else if (data.status === 'crashed') { color = '#e74c3c'; label = 'Crashed'; }
            else { color = '#7f8c8d'; label = 'Offline'; }

            dot.style.background = color;
            text.textContent = label;
            sc.textContent = `Servers: ${data.guildCount || 0}`;
            up.textContent = formatUptime(data.uptime || 0);
            lc.textContent = new Date(data.timestamp || Date.now()).toLocaleString();

            // commands
            cmds.innerHTML = '';
            (data.commands || []).forEach(c => {
                const el = document.createElement('div');
                el.style.display = 'flex';
                el.style.justifyContent = 'space-between';
                el.style.gap = '12px';
                el.innerHTML = `<div style="font-weight:700;color:#cfefff;">${c.cmd}</div><div style="color:#e6f8ff;opacity:0.9">${c.desc}</div>`;
                cmds.appendChild(el);
            });
        }

        function formatUptime(sec) {
            const s = Math.floor(sec || 0);
            const h = Math.floor(s/3600); const m = Math.floor((s%3600)/60); const ss = s%60;
            return `${h}h ${m}m ${ss}s`;
        }

        // auto refresh when on dashboard
        setInterval(() => {
            const dashboardVisible = document.getElementById('dashboard-page').classList.contains('active');
            if (dashboardVisible) fetchDashboard();
        }, 8000);

        // ensure dashboard tab activates correct view
        document.getElementById('codemasterTab').addEventListener('click', function(e){ e.preventDefault(); navigateTo('dashboard'); fetchDashboard(); });

        // Screen-size detection: sets data attribute on <body> and reacts to resize
        function updateScreenSizeClass() {
            const w = window.innerWidth || document.documentElement.clientWidth;
            const b = document.body;
            if (w < 720) b.dataset.screensize = 'small';
            else if (w < 1200) b.dataset.screensize = 'medium';
            else b.dataset.screensize = 'large';
        }
        window.addEventListener('resize', updateScreenSizeClass);
        // run once at load
        updateScreenSizeClass();

        function navigateTo(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Show selected page
            document.getElementById(page + '-page').classList.add('active');
            
            // Update active tab/button (tab-button and nav-button)
            document.querySelectorAll('.tab-button, .nav-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === page) {
                    btn.classList.add('active');
                }
            });

            // Update URL
            if (page === 'home') {
                window.history.pushState(null, '', '/');
            } else {
                window.history.pushState(null, '', '/' + page + '/');
            }
        }

        // Handle browser back/forward
        window.addEventListener('popstate', function() {
            const path = window.location.pathname;
            if (path.includes('github-connect')) {
                navigateTo('github-connect');
            } else {
                navigateTo('home');
            }
        });

        // GitHub Connect Button
        document.addEventListener("DOMContentLoaded", function() {
            const footer = document.querySelector('.site-footer-inner');
            if (footer) {
                footer.innerHTML = footer.innerHTML.replace(/Â© \d{4}/, `Â© ${new Date().getFullYear()}`);
            }

            // Get Discord ID from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const discordId = urlParams.get('discordId');

            // If Discord ID is present, IMMEDIATELY go to github-connect page
            if (discordId) {
                navigateTo('github-connect');
            } else {
                const path = window.location.pathname;
                if (path.includes('github-connect')) {
                    navigateTo('github-connect');
                }
            }

            const connectBtn = document.getElementById('connectBtn');
            
            if (connectBtn) {
                if (discordId) {
                    // If Discord ID is provided, initiate GitHub OAuth
                    connectBtn.href = `https://thecoffeylounge.com:3000/github/auth?discordId=${discordId}`;
                } else {
                    // Show error if no Discord ID
                    connectBtn.textContent = 'ERROR: NO DISCORD ID PROVIDED';
                    connectBtn.style.pointerEvents = 'none';
                    connectBtn.style.opacity = '0.6';
                }
            }
        });
    </script>
</body>
</html>
